<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="google-signin-client_id" content="668099731317-4baqud1mr58csb60bdcm23ch3tfmkuen.apps.googleusercontent.com">
    <meta name="description" content="Combine two elements to make a new element, if a combination doesn't currently create any element, you can suggest what element it should create.">
    <title>Elemental 4 - Combining Concepts</title>
    <link rel="shortcut icon" href="/res/ico/icon.ico">
    <link rel="icon" sizes="16x16 32x32 64x64" href="/res/ico/icon.ico">
    <link rel="icon" type="image/png" sizes="196x196" href="/res/ico/icon-192.png">
    <link rel="icon" type="image/png" sizes="160x160" href="/res/ico/icon-160.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/res/ico/icon-96.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/res/ico/icon-64.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/res/ico/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/res/ico/icon-16.png">
    <link rel="apple-touch-icon" href="/res/ico/icon-57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/res/ico/icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/res/ico/icon-72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/res/ico/icon-144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/res/ico/icon-60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/res/ico/icon-120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/res/ico/icon-76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/res/ico/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/res/ico/icon-180.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="/res/ico/icon-144.png">
    <meta name="msapplication-config" content="/res/browserconfig.xml">
    <meta name="theme-color" content=#da32e0>
    <link rel="manifest" href="/pwa.json">
    
    <style>
    header {
        background:white;
        padding-bottom:1em;
        text-align: center;
    }
    * {box-sizing: border-box;}
    body {
        font-family: sans-serif;
        height: 100%;
        margin: 0;
    }

    .bg {
        z-index: -9;
        top:0;
        left:0;
        width:100vw;
        height:100vh;
        position: fixed;
        background: linear-gradient(153deg, rgb(175, 95, 202) 0%, rgb(192, 109, 109) 100%);

    }
    button {
        margin:auto;
        margin-bottom: 1em;
        transition: all 300ms;
        box-shadow: 0 3px 1px -2px rgba(0,0,0,.2), 0 2px 2px 0 rgba(0,0,0,.14), 0 1px 5px 0 rgba(0,0,0,.12);
        align-items: center;
        border: none;
        border-radius: 4px;
        box-sizing: border-box;
        display: flex;
        font-family: Roboto,sans-serif;
        font-size: .875rem;
        font-weight: 500;
        height: 36px;
        justify-content: center;
        letter-spacing: .08929em;
        line-height: 2.25rem;
        line-height: inherit;
        min-width: 64px;
        outline: none;
        overflow: hidden;
        padding: 0 8px;
        position: relative;
        text-decoration: none;
        text-transform: uppercase;
        user-select: none;
        vertical-align: middle;
        background-color: black;
        color: white;
    }
    button:hover {
        background: #444;
    }
    button:focus {
        background: #444;
    }
    button:active {
        background: #666;
        transition: all 110ms;
    }
    button:disabled {
        transition: none;
        pointer-events: none;
        box-shadow: none;
        background: rgba(0,0,0,.12);
        color: rgba(0,0,0,.37);
    }
    main {
        padding: 1em;
    }
    .paper {
        transition: all 200ms;
        background: white;
        min-height: 100vh;
        box-shadow: 0 2px 6px rgba(0,0,0,.5)
    }
    .paper,main {
        margin: auto;
        max-width: 800px;
        width: 100%;
    }
    #support {
        text-align: center;
    }
    h1,h2,h3,h4 {
        margin-bottom: 0.25em;
    }
    h2+h3 {
        margin-top:0;
    }
    h3 {
        font-size: 1.15em;
        margin-bottom:0;
    }
    h3+p{
        margin-top:0.25em;
    }
    @media (max-width: 800px) {
        .paper {
            background:rgba(0, 0, 0, 0.15);
            color:white;
        }
        header {
            box-shadow: 0 2px 7px rgba(0, 0, 0, 0.2);
        }
    }
    .shrink img {
        transition: all 500ms cubic-bezier(0.75,0, 0, 1);
        height: 64px!important;
    }
    .shrink #T {
        transition: all 300ms;
        opacity: 0;
    }
    .expand,.expand main {
        transition: all 500ms cubic-bezier(0.75,0, 0, 1); 
    }
    .expand main {
        opacity: 0;
        pointer-events: none;
    }
    .expand {
        max-width: 100%;
    }
    @keyframes B {
        0% {top:100vh}
        100% {top:64px}
    }
    .agp {
        top:100vh;
        animation: B 300ms cubic-bezier(0.25, 0.75, 0.1, 1) 120ms;
        animation-fill-mode: forwards;
        position: fixed;
        width: 100%;
        height: calc(100vh - 64px);
        box-shadow: 0 0px 4px rgba(0, 0, 0, 0.2);
        background: #fafafa;
    }
    .launchonstart {
        display:none;
    }
    </style>
</head>
<body>
    <div id=b></div>
    <div class="bg" aria-hidden="true"></div>
    <div class="paper">
        <header>
            <div style=position:relative>
                <img src="/res/logo.svg" alt="Elemental 4" style=max-width:100%;height:8em;margin:auto>
                <div id="T" style=font-weight:bold;position:absolute;bottom:0.5em;width:100%;text-align:center;color:#da32e0;>Combining Concepts</div>
            </div>
        </header>
        <main id=menu>
            <p>
                Combine two elements to make a new element, if a combination doesn't currently create any element, you can suggest what
                element it should create. It is exactly how Elemental 3 worked, but it is not running anymore, so I created my own
                version.
            </p>
            
            <!-- <h2>FAQ</h2> -->
            <!-- <h3></h3> -->
            <!-- <p></p> -->
    
            <h2 style=text-align:center>Play the Game</h2>
            <p id="support">
                You need JavaScript enabled to run this game.
            </p>
            <p style=display:none id=mobile-warn>
                Your screen size is small. Not all the UI has been optimized for your screen size. You can still try playing the game, but it may be buggy.
            </p>
            
            <div class="g-signin2" data-onsuccess="onSignIn" style="margin:auto;display:none;margin-bottom:10px;width:120px"></div>
            <button id="launch" disabled>Launch!</button>
            <button id="install" aria-hidden=true style="opacity:0;transition:all 200ms" disabled>Install...</button>
            <div style="height:50px"></div>
            <div style="margin:auto;width:72px;opacity:.8">
                <a href="https://discord.gg/X9VyN42">
                    <img width=72 src="/res/discord.svg" alt="Discord Server Invite">
                </a>
            </div>
            <script>
            (function() {
                var id_token;
                function isSupported() {
                    try {
                        if(!console) throw "Console";
                        if(!document.createElement) throw "DOM handling functions";
                        if(!Element.prototype.remove) throw "DOM handling functions";
                        if(!window.fetch) throw "fetch function";
                        if(!Promise) throw "promises";
                        if(eval("((a, b) => a + b)(2, 6)") !== 8) throw "Arrow Functions";
                        if(eval("(function(){const x = 2; let y = 5; return x + y;})()") !== 7) throw "Let/Const variables";
                        
                        if(window.innerWidth < 450) {
                            document.querySelector("#mobile-warn").style.display = "";
                        }

                        console.log("All checks ran successfully.");
                        return true;
                        
                    } catch (error) {
                        if(console) console.error("Device not supported. Failed check: " + error);
                        return false;
                    }
                }
                document.getElementById("support").innerHTML = "Your device does not support this game.";
                if(isSupported()) {
                    document.getElementById("support").innerHTML = "Your device supports this game. Sign in with Google to play the game.";
                    var launch = document.getElementById("launch"); 
                    var gamehtml;
                    var head = document.getElementsByTagName('head')[0];
                    function link(uri) {
                        return new Promise(function (d) {
                            var link = document.createElement('link');
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = uri;
                            link.onload = d;
                            head.appendChild(link);
                        });
                    }
                    function gStealMessage() {
                        document.body.innerHTML = "<style>body{padding:20px}*{font-family:sans-serif}</style><h1 style='color:red'>!!! something crazy bad has gone wrong</h1><p>it seems that something is trying to steal your google account token, which should not be happening. make sure you don't have any malicious extensions enabled</p>"
                    }
                    Object.defineProperty(window, "$gID", { get: gStealMessage })
                    var promise = new Promise(function(d) {
                        window.onload = function() {
                            var p = Promise.all([
                                new Promise(function(d){
                                    // fetch the elemental resources
                                    var script = document.createElement('script');
                                    script.src = "/elemental.js";
                                    script.onload = d
                                    head.appendChild(script);
                                }),
                                link("/elemental.css"),
                                link("https://fonts.googleapis.com/icon?family=Material+Icons"),
                                link("https://fonts.googleapis.com/css?family=Roboto:300,400,500"),
                                new Promise(function(d) {
                                    fetch("/game.html").then(x => x.text()).then(text => {
                                        gamehtml = text;
                                        d();
                                    });
                                }),
                                new Promise(function(done, fail) {
                                    var is_signed_in = false;
                                    if("onSignIn" in window) {
                                        gStealMessage();
                                        fail();
                                    }
                                    Object.defineProperty(window, "onSignIn", {
                                        value: function (googleUser) {
                                            if(is_signed_in) return;
                                            is_signed_in = true;

                                            id_token = googleUser.getAuthResponse().id_token;
                                            launch.removeAttribute("disabled");
                                            document.getElementById("install").removeAttribute("disabled");
                                            document.querySelector(".g-signin2").style.display = "none";
                                            done();
                                        },
                                        writable: false
                                    })
                                    var script = document.createElement('script');
                                    script.src = "https://apis.google.com/js/platform.js";
                                    head.appendChild(script);
                                })
                            ]).then(() => {
                                d();
                                if ('serviceWorker' in navigator) {
                                    navigator.serviceWorker
                                        .register('/pwa.js');
                                }
                            });
                        }
                    });
                    var isResolved = false;
                    promise.then(function () {
                        isResolved = true;
                    });

                    var launchStart = window.location.href.indexOf("#game") !== -1;
                    launchStartViewElem = window.location.href.indexOf("#viewelement=");
                    window.launchStartViewSettings = window.location.href.indexOf("#settings") !== -1;
                    if(launchStartViewElem !== -1) launchStartViewElem = window.location.href.substr(launchStartViewElem+13); else launchStartViewElem = false;
                    document.querySelector(".g-signin2").style.display = "block";
                    
                    launch.onclick = function() {
                        launch.innerHTML = "Loading...";
                        launch.setAttribute("disabled", "true");
                        launch.blur();
                        launch.onclick = function() {};

                        // wait for stuff to load
                        function start() {
                            // animate-ify
                            var header = document.querySelector("header")
                            
                            header.className = "shrink";
                            document.querySelector(".paper").classList.add("expand");
                            document.querySelector("#b").classList.add("agp");
                            
                            setTimeout(function() {
                                // do some housecleaning
                                document.querySelector("#T").remove();
                                document.querySelector(".bg").remove();
                                document.body.appendChild(header);
                                document.querySelector(".paper").remove();
                                document.querySelector("style").remove();
                                header.removeAttribute("class");
                                header.appendChild(header.querySelector("img"));
                                header.querySelector("div").remove();
                                document.body.className = "game";      
                                
                                var main = document.createElement("main");
                                main.innerHTML = gamehtml;
                                document.body.appendChild(main);

                                setTimeout(function () {
                                    document.querySelector("#b").remove();
                                    document.body.className += " game2";      
                                    $initgame(id_token);
                                    var scr = document.createElement("script");
                                    scr.src = "https://browser.sentry-cdn.com/4.0.6/bundle.min.js";
                                    scr.onload = function() {
                                        console.debug('Loading Sentry');
                                        Sentry.init({ dsn: 'https://29aa868b2808482ba7ab3e870f9a0bc7@sentry.io/1296020' });
                                    };
                                    document.body.appendChild(scr);
                                }, 2);
                            }, (launchStart||launchStartViewElem)?0:500);
                        }
                        if(isResolved) start(); else promise.then(start);
                    }
                    if(launchStart||launchStartViewElem|| launchStartViewSettings) {
                        launch.removeAttribute("disabled");
                        launch.click();
                        document.querySelector("body").classList.add("launchonstart");
                        history.replaceState("",document.querySelector("title").innerHTML,"/#game");
                    }
                    window.addEventListener('beforeinstallprompt', function(e) {
                        e.preventDefault();
                        
                        var install = document.getElementById("install");
                        if(install){
                            var browser;
                            if((!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0) browser="Opera";
                            if(typeof InstallTrigger !== 'undefined') browser="Firefox";
                            if(/constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || safari.pushNotification)) browser="Safari";
                            if(!!window.StyleMedia) browser="Windows";
                            if(!!window.chrome) browser="Chrome";
                            
                            install.innerHTML = "Add to " + browser;
                            install.style.opacity=1;
                            install.removeAttribute("aria-hidden");
        
                            install.onclick=e.prompt.bind(e);
                        }
                    });
                }
            })();</script>
            <script src="" async defer></script>
        </main>
    </div>
</body>
</html>